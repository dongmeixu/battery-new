swagger: '2.0'
info:
  title: 服务端API
  description: 对接H5或者APP
  version: v1
host: localhost:9000
schemes:
  - http
basePath: /v1
produces:
  - application/json
#securityDefinitions:
#  bearer:
#    type: "apiKey"
#    name: "Authorization"
#    in: header
#    description: 基于JWT规范的API 访问token，
#security:
#  - bearer: []
tags:
  - name: Auth
    description: 授权
  - name: Users
    description: 用户
  - name: Certs
    description: 证书申请/审批/查
  - name: Trade
    description: 交易信息
  - name: Component
    description: 对应关系数据
  - name: Codes
    description: 二维码
  - name: Densitys
    description: 密度分析
  - name: Flows
    description: 流量分析
  - name: Pictures
    description: 图片
paths:
  '/trades':
    post:
      summary: 新增交易
      consumes:
        - application/json
      parameters:
        - name: trade
          in: body
          description: 交易信息
          required: true
          schema:
            $ref: '#/definitions/Trade'
      tags:
        - Trade
      responses:
        201:
          description: '成功,其URI 已经随Location 头信息返回'
        400:
          description: '错误的资源请求'
          schema:
            $ref: '#/definitions/Error'
        401:
          description: '资源授权错误'
          schema:
            $ref: '#/definitions/Error'
        403:
          description: '禁止访问资源'
          schema:
            $ref: '#/definitions/Error'
        404:
          description: '未找到对应的资源'
          schema:
            $ref: '#/definitions/Error'
        500:
          description: '服务内部错误'
          schema:
            $ref: '#/definitions/Error'
    get:
      tags:
      - 'Trade'
      summary: '查询交易数据'
      description: '查询交易数据'
      consumes:
      - 'application/json'
      parameters:
        - in: 'query'
          name: 'filters'
          type: string
          description: '查询条件,json 格式'
          required: true
        - name: limit
          in: query
          type: integer
          minimum: 0
          maximum: 100
          default: 10
          description: '条数'
        - name: offset
          in: query
          type: integer
          minimum: 0
          default: 0
          description: '起始位置'
      responses:
        200:
          description: '服务器正常返回'
          schema:
            type: array
            items:
              $ref: '#/definitions/Trade'
        400:
          description: '错误的资源请求'
          schema:
            $ref: '#/definitions/Error'
        401:
          description: '资源授权错误'
          schema:
            $ref: '#/definitions/Error'
        403:
          description: '禁止访问资源'
          schema:
            $ref: '#/definitions/Error'
        500:
          description: '服务内部错误'
          schema:
            $ref: '#/definitions/Error'
  '/trades/{id}':
    get:
      summary: 获取交易信息
      consumes:
        - application/json
      parameters:
        - name: id
          in: path
          description: 交易id
          type: string
          required: true
      tags:
        - Component
      responses:
        200:
          description: 成功
          schema:
            $ref: '#/definitions/Trade'
        400:
          description: '错误的资源请求'
          schema:
            $ref: '#/definitions/Error'
        401:
          description: '资源授权错误'
          schema:
            $ref: '#/definitions/Error'
        403:
          description: '禁止访问资源'
          schema:
            $ref: '#/definitions/Error'
        404:
          description: '未找到对应的资源'
          schema:
            $ref: '#/definitions/Error'
        500:
          description: '服务内部错误'
          schema:
            $ref: '#/definitions/Error'
  '/scans':
    post:
      summary: 新增二维码扫描记录
      consumes:
        - application/json
      parameters:
        - name: scan
          in: body
          description: 二维码扫描记录
          required: true
          schema:
            $ref: '#/definitions/Scan'
      tags:
        - Trade
      responses:
        201:
          description: '成功,其URI 已经随Location 头信息返回'
        400:
          description: '错误的资源请求'
          schema:
            $ref: '#/definitions/Error'
        401:
          description: '资源授权错误'
          schema:
            $ref: '#/definitions/Error'
        403:
          description: '禁止访问资源'
          schema:
            $ref: '#/definitions/Error'
        404:
          description: '未找到对应的资源'
          schema:
            $ref: '#/definitions/Error'
        500:
          description: '服务内部错误'
          schema:
            $ref: '#/definitions/Error'
    get:
      tags:
      - 'Trade'
      summary: '查询二维码扫描记录数据'
      description: '查询二维码扫描记录数据'
      consumes:
      - 'application/json'
      parameters:
        - in: 'query'
          name: 'filters'
          type: string
          description: '查询条件,json 格式'
          required: true
        - name: limit
          in: query
          type: integer
          minimum: 0
          maximum: 100
          default: 10
          description: '条数'
        - name: offset
          in: query
          type: integer
          minimum: 0
          default: 0
          description: '起始位置'
      responses:
        200:
          description: '服务器正常返回'
          schema:
            type: array
            items:
              $ref: '#/definitions/Scan'
        400:
          description: '错误的资源请求'
          schema:
            $ref: '#/definitions/Error'
        401:
          description: '资源授权错误'
          schema:
            $ref: '#/definitions/Error'
        403:
          description: '禁止访问资源'
          schema:
            $ref: '#/definitions/Error'
        500:
          description: '服务内部错误'
          schema:
            $ref: '#/definitions/Error'
  /packages/{id}:
    get:
      summary: 获取电池包信息
      consumes:
        - application/json
      parameters:
        - name: id
          in: path
          description: 电池包id
          type: string
          required: true
      tags:
        - Component
      responses:
        200:
          description: 成功
          schema:
            $ref: '#/definitions/Package'
        400:
          description: '错误的资源请求'
          schema:
            $ref: '#/definitions/Error'
        401:
          description: '资源授权错误'
          schema:
            $ref: '#/definitions/Error'
        403:
          description: '禁止访问资源'
          schema:
            $ref: '#/definitions/Error'
        404:
          description: '未找到对应的资源'
          schema:
            $ref: '#/definitions/Error'
        500:
          description: '服务内部错误'
          schema:
            $ref: '#/definitions/Error'
  /packages:
    post:
      tags:
      - 'Component'
      summary: '上传电池包（与模组对应关系）数据'
      description: '电池生产商上传电池包与模组的对应关系'
      consumes:
      - 'application/json'
      parameters:
      - in: 'body'
        name: 'package'
        description: '电池包信息.'
        required: true
        schema:
          $ref: '#/definitions/Package'
      responses:
        201:
          description: '成功,其URI 已经随Location 头信息返回'
        400:
          description: '错误的资源请求'
          schema:
            $ref: '#/definitions/Error'
        401:
          description: '资源授权错误'
          schema:
            $ref: '#/definitions/Error'
        403:
          description: '禁止访问资源'
          schema:
            $ref: '#/definitions/Error'
        404:
          description: '未找到对应的资源'
          schema:
            $ref: '#/definitions/Error'
        500:
          description: '服务内部错误'
          schema:
            $ref: '#/definitions/Error'
  /cars:
    post:
      tags:
      - 'Component'
      summary: '上传汽车（与电池包对应关系）数据'
      description: '汽车制造商上传汽车与电池包的对应关系'
      consumes:
      - 'application/json'
      parameters:
      - in: 'body'
        name: 'package'
        description: '汽车基本信息.'
        required: true
        schema:
          $ref: '#/definitions/Car'
      responses:
        201:
          description: '成功,其URI 已经随Location 头信息返回'
        400:
          description: '错误的资源请求'
          schema:
            $ref: '#/definitions/Error'
        401:
          description: '资源授权错误'
          schema:
            $ref: '#/definitions/Error'
        403:
          description: '禁止访问资源'
          schema:
            $ref: '#/definitions/Error'
        500:
          description: '服务内部错误'
          schema:
            $ref: '#/definitions/Error'
  '/cars/{id}':
    get:
      summary: 获取汽车基本信息
      consumes:
        - application/json
      parameters:
        - name: id
          in: path
          description: 汽车id
          type: string
          required: true
      tags:
        - Component
      responses:
        200:
          description: 成功
          schema:
            $ref: '#/definitions/Car'
        400:
          description: '错误的资源请求'
          schema:
            $ref: '#/definitions/Error'
        401:
          description: '资源授权错误'
          schema:
            $ref: '#/definitions/Error'
        403:
          description: '禁止访问资源'
          schema:
            $ref: '#/definitions/Error'
        404:
          description: '未找到对应的资源'
          schema:
            $ref: '#/definitions/Error'
        500:
          description: '服务内部错误'
          schema:
            $ref: '#/definitions/Error'

  '/certs':
      post:
        summary: 提交证书申请
        consumes:
          - application/json
        parameters:
          - name: cert
            in: body
            description: 证书申请信息
            required: true
            schema:
              $ref: '#/definitions/Cert'
        tags:
          - Certs
        responses:
          201:
            description: 提交成功，等待审核
  '/certs/{status}':
    get:
      summary: 申请查询(status=0:待审批 status=1:审批通过 status=2:审批不通过)
      description: status
      consumes:
         - application/json
      parameters:
        - name: status
          in: path
          description: 证书申请状态；0:未审核(默认) 1：审核通过 2：审核不通过
          required: true
          type: integer
        - in: query
          name: filters
          type: string
          description: 查询条件,json 格式, {companyName:'',startDate:'',endDate:''}
          required: true
        - name: limit
          in: query
          type: integer
          minimum: 0
          maximum: 100
          default: 10
          description: 条数
        - name: offset
          in: query
          type: integer
          minimum: 0
          default: 0
          description: 起始位置
      tags:
        - Certs
      responses:
        201:
          description: 成功
          schema:
            type: array
            items:
              $ref: '#/definitions/Cert'
        400:
          description: '错误的资源请求'
          schema:
            $ref: '#/definitions/Error'
        401:
          description: '资源授权错误'
          schema:
            $ref: '#/definitions/Error'
        403:
          description: '禁止访问资源'
          schema:
            $ref: '#/definitions/Error'
        404:
          description: '未找到对应的资源'
          schema:
            $ref: '#/definitions/Error'
        500:
          description: '服务内部错误'
          schema:
            $ref: '#/definitions/Error'
  '/certs/{ids}':
    put:
      summary: 证书审批
      consumes:
         - application/json
      parameters:
        - name: ids
          in: path
          description: 证书id
          required: true
          type: array
          items:
            type: string
        - name: status
          in: query
          description: 证书申请状态；0:未审核(默认) 1：审核通过 2：审核不通过
          required: true
          type: integer
      tags:
        - Certs
      responses:
        201:
          description: 成功
          schema:
            type: array
            items:
              $ref: '#/definitions/Cert'
        400:
          description: '错误的资源请求'
          schema:
            $ref: '#/definitions/Error'
        401:
          description: '资源授权错误'
          schema:
            $ref: '#/definitions/Error'
        403:
          description: '禁止访问资源'
          schema:
            $ref: '#/definitions/Error'
        404:
          description: '未找到对应的资源'
          schema:
            $ref: '#/definitions/Error'
        500:
         description: '服务内部错误'
         schema:
            $ref: '#/definitions/Error'
  '/certs/{companyId}':
    get:
      summary: 我的申请
      description: companyId
      consumes:
        - application/json
      parameters:
        - name: companyId
          in: path
          description: 企业Id
          type: string
          required: true
      tags:
        - Certs
      responses:
        200:
          description: 成功
          schema:
            type: array
            items:
              $ref: '#/definitions/Cert'
        400:
          description: '错误的资源请求'
          schema:
            $ref: '#/definitions/Error'
        401:
          description: '资源授权错误'
          schema:
            $ref: '#/definitions/Error'
        403:
          description: '禁止访问资源'
          schema:
            $ref: '#/definitions/Error'
        404:
          description: '未找到对应的资源'
          schema:
            $ref: '#/definitions/Error'
        500:
          description: '服务内部错误'
          schema:
            $ref: '#/definitions/Error'
  '/certs/imports':
    post:
      summary:  证书导入
      description: 将证书打包导入
      consumes:
         - application/json
      parameters:
         - name: attachment
           in: formData
           description: 导入的zip包
           required: true
           type: file
         - name: remark
           in: query
           description: 文字说明
           type: string
      tags:
         - Certs
      responses:
        201:
          description: 成功
        400:
          description: '错误的资源请求'
          schema:
            $ref: '#/definitions/Error'
        401:
          description: '资源授权错误'
          schema:
            $ref: '#/definitions/Error'
        403:
          description: '禁止访问资源'
          schema:
            $ref: '#/definitions/Error'
        404:
          description: '未找到对应的资源'
          schema:
            $ref: '#/definitions/Error'
        500:
          description: '服务内部错误'
          schema:
            $ref: '#/definitions/Error'
  '/attachments':
    post:
      summary:  附件上传
      description: 企业法人证书等附件上传
      parameters:
         - name: attachment
           in: formData
           description: 法人证书
           required: true
           type: file
      tags:
         - Certs
      responses:
        201:
          description: 成功
        400:
          description: '错误的资源请求'
          schema:
            $ref: '#/definitions/Error'
        401:
          description: '资源授权错误'
          schema:
            $ref: '#/definitions/Error'
        403:
          description: '禁止访问资源'
          schema:
            $ref: '#/definitions/Error'
        404:
          description: '未找到对应的资源'
          schema:
            $ref: '#/definitions/Error'
        500:
          description: '服务内部错误'
          schema:
            $ref: '#/definitions/Error'

  '/single2dcodes':
    post:
      summary:  单个二维码生成
      description: 单个二维码生成
      consumes:
         - application/json
      parameters:
         - in: query
           name: moduleId
           type: string
           description: 查询条件,电池模组id(流水号)
           required: true
      tags:
         - Codes
      response:
         201:
          description: 服务器正常返回
          schema:
            $ref: '#/definitions/Pictures'

  '/batch2dcodes':
    post:
      summary:  批量二维码生成
      description: 批量二维码生成
      consumes:
         - application/json
      parameters:
         - in: query
           name: beginModuleId
           type: string
           description: 起始电池模组id(起始流水号)
           required: true
         - in: query
           name: endModuleId
           type: string
           description: 截止电池模组id(截止流水号)
           required: true
      tags:
         - Codes
      response:
         201:
          description: 服务器正常返回
          schema:
            $ref: '#/definitions/Pictures'

  '/flows':
    get:
      summary:  获取流量分析图
      description: 获取流量分析图
      consumes:
         - application/json
      parameters:
        - in: query
          name: beginModuleId
          type: string
          description: 起始电池模组id(起始流水号)
          required: true
        - in: query
          name: endModuleId
          type: string
          description: 截止电池模组id(截止流水号)
          required: true
      tags:
         - Flows
      response:
         201:
          description: 服务器正常返回
          schema:
            $ref: '#/definitions/Module'

  '/densitys':
    get:
      summary:  获取密度分析图
      description: 获取密度分析图
      consumes:
         - application/json
      parameters:
        - in: query
          name: beginModuleId
          type: string
          description: 起始电池模组id(起始流水号)
          required: true
        - in: query
          name: endModuleId
          type: string
          description: 截止电池模组id(截止流水号)
          required: true
      tags:
         - Densitys
      response:
         201:
          description: 服务器正常返回
          schema:
            $ref: '#/definitions/Module'

  '/auth':
    post:
      summary: 获取授权token
      consumes:
         - application/json
      parameters:
        - name: auth
          in: body
          description: 用户信息.
          required: true
          schema:
              $ref: '#/definitions/Auth'
      tags:
        - Auth
      responses:
        201:
          description: 服务器正常返回
          schema:
            $ref: '#/definitions/Token'

  '/users':
    post:
      summary: 注册用户
      consumes:
        - application/json
      parameters:
        - name: user
          in: body
          description: 用户信息
          required: true
          schema:
            $ref: '#/definitions/User'
      tags:
        - Users
      responses:
        '201':
          description: 注册成功

  '/users/{id}':
    get:
      summary: 获取用户信息
      consumes:
        - application/json
      parameters:
        - name: id
          in: path
          description: 用户id
          type: string
          required: true
      tags:
        - Users
      responses:
        '200':
          description: 注册成功
          schema:
            $ref: '#/definitions/User'

definitions:
  Cert:
    type: object
    properties:
      companyType:
        type: integer
        description: 企业类型(0:电池厂商 1:汽车厂商)
      companyName:
        type: string
        description: 企业名称
      creditCode:
        type: string
        description: 社会信用码
      vendorCode:
        type: string
        description: 厂商代码
      contact:
        type: string
        description: 联系人
      phone:
        type: string
        description: 联系电话
      email:
        type: string
        description: 电子邮箱
      status:
        type: integer
        description: 申请证书的状态
      certPath:
        type: string
        description: 证书的文件路径
      modifyTime:
        type: string
        description: 修改时间

    required:
      - companyType
      - companyName
      - creditCode
      - vendorCode
      - phone
      - email
    example:
      companyType: 1
      companyName: "电池厂商1"
      creditCode: "911199R"
      vendorCode: "111111"
      contact: "张三"
      phone: "13728783627"
      email: "894738373@qq.com"
      status: 0

  User:
    type: object
    properties:
      userName:
        type: string
        description: 手机号码
      password:
        type: string
        description: 密码
      createDate:
        type: string
        format: date
        description: 日期
      state:
        type: integer
        format: int32
        description: 状态
    required:
      - userName
      - password
    example:
      userName: "zhangsan"
      password: "justPass"
      createDate: "2016-01-01"
      state: 0
  Auth:
    type: object
    properties:
      userName:
        type: string
        description: user name
      password:
        type: string
        description: 密码
    required:
      - userName
      - password
    example:
      userName: '18955555555'
      password: 'justPass'

  Token:
    type: object
    properties:
      token:
        type: string
        description: 返回的token
      userId:
        type: integer
        format: int64
        description: 用户id
      userName:
        type: string
        description: 用户名
    example:
      token: "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpZCI6MywiZXhwIjoxNDcwODI5NDk1LCJ1c2VyIjp7ImlkIjozLCJwYXNzd29yZCI6IjgxY2UyYmRjMTdlMjVmNWY0MjcyMWY1ZjEzYWU5NTYwODBjNzMzOGM4ZGYwODk2OTA4MDY5MzhmNmM3MjAyODEiLCJzYWx0IjoiNTRhOTQ0ZWUtZDRkYy00ZjcyLWE2N2EtNzBiZTE4ZDc3MjMxIiwicGhvbmVOdW1iZXIiOiIxOTk5OTk5OTk5IiwiY3JlYXRUaW1lIjpudWxsLCJ1cGRhdGVUaW1lIjpudWxsLCJwZXJzaXN0ZW50Ijp0cnVlLCJlbnRpdHlJZCI6M30sImlhdCI6MTQ3MDgyNTg5NX0.kwoSodGxS81HPWCiIydk0Z4Of6rljkR6hLAQ1VNeYhs"
      userId: 100
      userName: "18955555555"

  Error:
    type: object
    properties:
      code:
        type: integer
        format: int32
        description: 参见 `ErrorCode` 中的定义
      message:
        type: string
        description: 错误描述
      detail:
        type: string
        description: 错误的详细信息
  Scan:
      type: 'object'
      required:
        - id
        - scannerId
        - barcode
        - timestamp
      properties:
        id:
          type: string
          description: 'id'
        scannerId:
          type: string
          description: '扫描者ID'
        barcode:
          type: string
          description: '二维码内容'
        longitude:
          type: number
          format: double
          description: '扫描者所在位置的经度'
        latitude:
          type: number
          format: double
          description: '扫描者所在位置的纬度'
        timestamp:
          $ref: '#/definitions/Timestamp'
  Trade:
    type: 'object'
    required:
      - block
      - fromId
      - productIds
      - toId
      - timestamp
    properties:
      id:
        type: string
        description: '对象id'
        maxLength: 30
      fromId:
        type: string
        description: '卖家ID'
      from:
        type: 'string'
        description: '卖家'
      to:
        type: 'string'
        description: '买家'
      toId:
        type: 'string'
        description: '买家Id'
      productIds:
        type: array
        items:
          type: string
        description: '交易物品ID'
      timestamp:
        $ref: '#/definitions/Timestamp'
      block:
        $ref: '#/definitions/Block'
      transaction:
        $ref: '#/definitions/Transcation'

  Package:
    type: 'object'
    required:
      - packageId
      - packageSpec
      - modules
      - manufacturer
      - timestamp
    properties:
      packageId:
        type: 'string'
        description: '电池包id'
      packageSpec:
        type: 'string'
        description: '电池包规格'
      modules:
        type: 'array'
        items:
          $ref: '#/definitions/Module'
      manufacturer:
        type: 'string'
        description: '生产厂家'
      timestamp:
        $ref: '#/definitions/Timestamp'
    example:
      packageId: '507f191e810c19729de860ea'
      packageSpec: '{标称容量:5300mAh,电芯内阻:15mΩ,最大充电电流:1C}'
      manufacturer: 'v'
      modules: [{'moduleId': '507f191e810c19729de860ea','moduleSpec': '{标称容量:5300mAh,电芯内阻:15mΩ,最大充电电流:1C}', 'manufacturer': '波士顿'},
               {'moduleId': '507f191e810c19729de860eb','moduleSpec': '{标称容量:5300mAh,电芯内阻:15mΩ,最大充电电流:1C}', 'manufacturer': '波士顿'}]
      timestamp: {'nanos': 206716775}
  Car:
    type: 'object'
    properties:
      carId:
        type: 'string'
        description: '电池模组id'
        maxLength: 512
      vin:
        type: 'string'
        description: '车架号'
      packageId:
        type: 'string'
        description: '电池包id'
        maxLength: 512
      carSpec:
        type: 'string'
        description: '规格'
      manufacturer:
        type: 'string'
        description: '生产厂家'
      timestamp:
        $ref: '#/definitions/Timestamp'
    example:
      carId: '6e7f191e889019729de860ab'
      vin: 'WDBGP57B6PB127810'
      packageId: '507f191e810c19729de860ea'
      carSpec: '{标称容量:5300mAh,电芯内阻:15mΩ,最大充电电流:1C}'
      manufacturer: '一汽大众'
      timestamp: {'nanos': 206716775}
  Block:
    type: 'object'
    required:
      - blockId
      - stateHash
    properties:
      blockId:
        type: string
        description: 'block id'
      version:
        type: 'string'
        description: 'block version'
        default: '1'
      transactions:
        type: 'array'
        description: 'transcations of block'
        items:
          $ref: '#/definitions/Transcation'
      transactionsHash:
        type: 'string'
        description: 'The merkle root hash of the block’s transactions.'
      stateHash:
        type: 'string'
        description: 'The merkle root hash of the world state.'
      previousBlockHash:
        type: 'string'
        description: '前一个块的Hash'
  Transcation:
    type: 'object'
    properties:
      chaincodeId:
        type: 'string'
        description: 'chaincode id'
      chaincodeType:
        type: 'string'
        description: 'type'
        enum:
          - UNDEFINED
          - CHAINCODE_DEPLOY
          - CHAINCODE_INVOKE
          - CHAINCODE_QUERY
          - CHAINCODE_TERMINATE
      uuid:
        type: 'string'
        description: 'transcation id'
      cert:
        type: 'string'
        description: 'Certificate of the transactor. '
      payload:
        type: 'string'
        description: 'payload hash'
      signature:
        type: string
        description: 'Signature of the transactor.'
    example:
      chaincodeId: '59d5075e7146d8df37bdcb0c289c293c66ee2a56c0f8d833410ff7cd8d3dd6c65ff0c6966c1914109ed7e04423bc73967b7c693fbeb383bb1a057c75b37e2674'
      chaincodeType: 'UNDEFINED'
      uuid: '1908394-9840-496e-ab58-e9f6688cc3f5'
      payload: 'Ch4IARIGEgRteWNjGhIKBmludm9rZRIBYRIBYhICMTA='
      cert: 'wMTI1kjEqeFM9co0='
      signature: 'MGUCMCIJaCT3YRsjXt4TzwfmD9hg9pxYnV13kWgf7e1hAW5Nar//05kFtpVlq83X+YtcmAIxAK0IQlCgS6nqQzZEGCLd9r7cg1AkQOT/RgoWB8zcaVjh3bCmgYHsoPAPgMsi3TJktg=='
  Timestamp:
    type: 'object'
    required:
      - seconds
    properties:
      nanos:
        type: integer
        format: int64
        description: 'nanos from epoch'
    example:
      nanos: 2067167
  Module:
    type: 'object'
    properties:
      moduleId:
        type: 'string'
        description: '电池模组id'
      moduleSpec:
        type: 'string'
        description: '电池模组规格'
      manufacturer:
        type: 'string'
        description: '生产厂家'
      timestamp:
        $ref: '#/definitions/Timestamp'
    example:
      moduleId: '507f191e810c19729de860ea'
      moduleSpec: '{标称容量:5300mAh,电芯内阻:15mΩ,最大充电电流:1C}'
      manufacturer: '波士顿'
      timestamp: {'nanos': 206716775}